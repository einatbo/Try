#/*---------------------------------------------------------------------------------------------------------*/
#/*  Nuvoton Technology Corporation confidential                                                            */
#/*                                                                                                         */
#/*  Copyright (c) 2010 by Nuvoton Technology Corporation                                                   */
#/*  All rights reserved                                                                                    */
#/*                                                                                                         */
#/*<<<------------------------------------------------------------------------------------------------------*/
#/* File Contents:                                                                                          */
#/*   start.sp                                                                                              */
#/*            This file contains CR initialization code                                                    */
#/* Project:                                                                                                */
#/*           Multi Touch                                                                                   */
#/*---------------------------------------------------------------------------------------------------------*/

    .text
    .align          2
    .globl          _start
    .code_label     _main
    .code_label     _HFCG_Config
    .code_label     _CR_InitBssData
    .code_label     _start

start::
_start:

#/*---------------------------------------------------------------------------------------------------------*/
#/* Initialize the stack pointers. The constants __STACK_START and __ISTACK_START should be defined in the  */
#/* inker definition file.                                                                                  */
#/*---------------------------------------------------------------------------------------------------------*/
    movd    $__STACK_START, (sp)
    movd    $__ISTACK_START, (r1,r0)
    lprd    (r1,r0), isp


#/*---------------------------------------------------------------------------------------------------------*/
#/* Disable all interrupts by clearing PSR                                                                  */
#/*---------------------------------------------------------------------------------------------------------*/
    movw    $0, r0
    lpr     r0, psr

#/*---------------------------------------------------------------------------------------------------------*/
#/* Initialize the default sections according to the linker definition file                                 */
#/*---------------------------------------------------------------------------------------------------------*/
    bal (ra), _CR_InitBssData

#/*---------------------------------------------------------------------------------------------------------*/
#/* Set the Extended Dispatch bit in the CFG register (this is the default configuration for CR16C)         */
#/* and enable instruction cache                                                                            */
#/*---------------------------------------------------------------------------------------------------------*/
    spr     cfg, r0
    orw     $0x110, r0
    lpr     r0, cfg

#/*---------------------------------------------------------------------------------------------------------*/
#/* Configure high frequency clock                                                                          */
#/*---------------------------------------------------------------------------------------------------------*/
    bal (ra), _HFCG_Config


#/*---------------------------------------------------------------------------------------------------------*/
#/* Jump to the main function                                                                               */
#/*---------------------------------------------------------------------------------------------------------*/
    bal (ra), _main
